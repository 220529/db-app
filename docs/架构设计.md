# db-app - 架构设计

> **最后更新**: 2025-12-01

## 组件清单

| 服务 | 版本 | 端口 | 数据卷 |
|------|------|------|--------|
| MySQL | 8.0 | 3306 | /var/lib/mysql |
| Redis | 7-alpine | 6379 | /data |

## 网络架构

```
erp-db-network (bridge)
├── erp-mysql
├── erp-redis  
├── erp-core (连接)
└── erp-web (连接)
```

**设计要点**: 
- external 网络，由 db-app 创建
- 所有 ERP 服务通过此网络互联

## MySQL 配置

### 数据库清单

| 数据库 | 用途 | 用户 |
|--------|------|------|
| `erp_core` | 生产数据 | erp_user |
| `erp_test` | 测试数据 | erp_user |

### 初始化脚本

```sql
-- init-scripts/01-create-databases.sql
CREATE DATABASE IF NOT EXISTS `erp_core`;
CREATE USER IF NOT EXISTS 'erp_user'@'%' IDENTIFIED BY '***';
GRANT ALL ON `erp_core`.* TO 'erp_user'@'%';
```

### 性能配置

```ini
# my.cnf
max_connections = 100
innodb_buffer_pool_size = 256M
slow_query_log = ON
long_query_time = 1
```

## Redis 配置

```conf
# redis.conf
maxmemory 128mb
maxmemory-policy allkeys-lru
```

## 备份策略

```bash
# 每日 2:00 备份
0 2 * * * docker exec erp-mysql mysqldump \
  -u root -p$MYSQL_ROOT_PASSWORD erp_core > \
  /backups/erp_$(date +\%Y\%m\%d).sql
```

## 相关文档

- [部署说明](./部署说明.md)
- [优化建议](./优化建议.md)
