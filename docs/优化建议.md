# db-app - 优化建议

> **最后更新**: 2025-12-01

## MySQL 优化

### 连接池

```ini
# my.cnf
max_connections = 100
wait_timeout = 300
```

### InnoDB 配置

```ini
innodb_buffer_pool_size = 256M
innodb_log_file_size = 128M
innodb_flush_log_at_trx_commit = 1
```

### 慢查询

```ini
slow_query_log = ON
long_query_time = 1
```

---

## Redis 优化

### 内存配置

```conf
maxmemory 128mb
maxmemory-policy allkeys-lru
```

### 持久化

```conf
# RDB
save 900 1
save 300 10

# AOF (可选)
appendonly no
```

---

## 备份策略

### MySQL 备份

```bash
# 每日备份
0 2 * * * docker exec erp-mysql mysqldump \
  -u root -p$PASSWORD erp_core > \
  /backups/erp_$(date +\%Y\%m\%d).sql

# 保留最近 30 天
find /backups -name "erp_*.sql" -mtime +30 -delete
```

### Redis 备份

```bash
# 复制 RDB 文件
cp /var/lib/docker/volumes/redis_data/_data/dump.rdb \
   /backups/redis_$(date +\%Y\%m\%d).rdb
```

---

## 监控

### 检查 MySQL 状态

```bash
docker exec erp-mysql mysql -u root -p -e \
  "SHOW GLOBAL STATUS LIKE 'Threads_connected';"
```

### 检查 Redis 内存

```bash
docker exec erp-redis redis-cli INFO memory
```

---

## 高可用 (可选)

### MySQL 主从复制

```
Master (写) ← → Slave (读)
```

### Redis Sentinel

```
哨兵监控 → 自动故障转移
```
